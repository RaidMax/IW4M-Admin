

# IW4MAdmin
### Инструкция по использованию
### Версия 2.1
_______
### Об инструменте
**IW4MAdmin** - это инструмент администрирования для [IW4x](https://iw4xcachep26muba.onion.link/), [Pluto T6](https://forum.plutonium.pw/category/33/plutonium-t6), [Pluto IW5](https://forum.plutonium.pw/category/5/plutonium-iw5), и большинства выделенных серверов Call of Duty®. Он позволяет полностью контролировать ваш сервер; от смены карт и до бана игроков, **IW4MAdmin** мониторит и записывает активность на вашем сервере(ах) с отображением происходящего на веб-интерфейсе в режиме реального времени. Благодаря поддержке плагинов его функциональность расширяется подобно легкому бризу..

### Подготовка
Для работы **IW4MAdmin** требуется минимальная конфигурация. Существует только одно предпосылка.  
* [.NET Core 2.0.7 Runtime](https://www.microsoft.com/net/download/dotnet-core/runtime-2.0.7) *или новее*  

1. Распакуйте `IW4MAdmin-<version>.zip`  
2. Откройте командную строку или терминал в распакованной папке
3. Введите `dotnet IW4MAdmin.dll` и нажмите *Enter*, или же для _Windows_ создайте *bat*, или *cmd* файл с таким содержимым и запускайте в дальнейшем с него:

`@echo off`

`dotnet IW4MAdmin.dll`
_______

### Конфигурация
#### Первичная конфигурация
Когда **IW4MAdmin** запускается в _первый раз_, вам будет предложено настроить вашу конфигурацию.

`Включить веб-интерфейс`
* Позволяет монторить и контролировать ваш сервер(ы) через веб-интерфейс [по умолчанию `http://127.0.0.1:1624`]

`Включить поддержку нескольких владельцев`
* Позволяет назначать более одного клиента на уровень `Owner`

`Включить последовательную иерархию прав`
* Позволяет привилегированным клиентам назначать других клиентов до уровня коротый ниже их текущего уровня

`Включить серверное имя для чата`
* Показывает префикс для каждого сообщения отправленного **IW4MAdmin** -- `[Admin] message`
* _Эта функция требует указания пользовательского имени_

`Разрешить игрокам подключаться с VPN`
* Разрешить клиентам использовать [VPN](https://en.wikipedia.org/wiki/Virtual_private_network) 
* _Для этой функции требуется активный ключ api на [iphub.info](https://iphub.info/)_

`Отображать ссылку на Discord в веб-интерфейсе`
* Показывает ссылку на discord вашего сервера на веб-сайте
* _Для этой функции требуется ссылка приглашения на ваш сервер discord_

`Использовать иную кодировку текста`
* Позволяет использовать альтернативные кодировки для разбора игровой информации и событий
* **Русскоязычные пользователи для отображения кириллицы должны использовать это и указать** `windows-1251` **в качестве кодировки текста**

#### Расширенная настройка
Если вы хотите дополнительно настроить работу **IW4MAdmin** то следующие файлы конфигурации позволят вам изменить основные параметры с помощью любого текстового редактора.

#### `IW4MAdminSettings.json`-- _этот файл создается после начальной настройки_
* Этот файл использует спецификацию [JSON](https://en.wikipedia.org/wiki/JSON#JSON_sample), поэтому пожалуйста проверьте его перед запуском **IW4MAdmin**

`WebfrontBindUrl`
* Указывает адрес и порт, которые будут показывать веб-интерфейс.
* Значение может быть [IP-адрес](https://en.wikipedia.org/wiki/IP_address):порт или [Доменное имя](https://en.wikipedia.org/wiki/Domain_name):порт

`Servers`
* Задает список серверов для мониторинга в **IW4MAdmin**
* `IPAddress`
	* Указывает IP-адрес конкретного сервера
* `Port`
	* Указывает порт конкретного сервера
* `Password`
	* Указывает `rcon_пароль` конкретного сервера
* `AutoMessages`
	* Задает список сообщений передаваемых на конкретный сервер
* `Rules`
	* Задает список правил для конкретного сервера

`AutoMessagePeriod`
* Указывает период (в секундах), как часто сообщения должны транслироваться на сервере(ах)

`AutoMessages`
* Задает список сообщений, которые транслируются на **все** сервера

`GlobalRules`
* Задает список правил применимых ко **всем** серверам

`Maps`
* Задает список карт для каждой поддерживаемой игры.
* `Name`
	* Указывает имя карты возвращаемой игрой
* `Alias`
	* Указывает отображаемое имя карты (как видно при загрузке)
___

### Команды
|Полное Имя              |Короткое|Описание                                                                               |Надобность цели|Синтаксис           |Требуемый уровень|
|--------------| -----| --------------------------------------------------------| -----------------| -------------| ----------------|
|prune|pa|разжаловать любых администраторов, которые не подключались в последнее время (по умолчанию - 30 дней)|Нет|!pa \<опционально неактивные дни\>|Owner|
|quit|q|выход с IW4MAdmin|Нет|!q |Owner|
|rcon|rcon|отправить rcon команду на сервер|Нет|!rcon \<команда\>|Owner|
|ban|b|навсегда забанить игрока на сервере|Да|!b \<игрок\> \<причина\>|SeniorAdmin|
|unban|ub|разбанить игрока по ID в базе данных|Да|!ub \<ID в базе данных\> \<причина\>|SeniorAdmin|
|find|f|найти игрока в базе данных|Нет|!f \<игрок\>|Administrator|
|killserver|kill|отключить игровой сервер|Нет|!kill |Administrator|
|map|m|изменить на указанную карту|Нет|!m \<карта\>|Administrator|
|maprotate|mr|загрузка следующей карты по ротации|Нет|!mr |Administrator|
|plugins|p|просмотреть все загруженные плагины|Нет|!p |Administrator|
|alias|known|получить прошлые псевдонимы и ips игрока|Да|!known \<игрок\>|Moderator|
|baninfo|bi|получить информацию о бане игрока|Да|!bi \<игрок\>|Moderator|
|fastrestart|fr|быстрая перезагрузка текущей карты|Нет|!fr |Moderator|
|flag|fp|отметить подозрительного игрока и объявить админам о его присоединении|Да|!fp \<игрок\> \<причина\>|Moderator|
|list|l|список активных клиентов|Нет|!l |Moderator|
|mask|hide|скрыть свое присутствие в качестве администратора|Нет|!hide |Moderator|
|reports|reps|получить или очистить последние жалобы|Нет|!reps \<опционально clear\>|Moderator|
|say|s|широковещательное сообщение всем игрокам|Нет|!s \<сообщение\>|Moderator|
|setlevel|sl|назначить игрока на указанный уровень администрирования|Да|!sl \<игрок\> \<уровень\>|Moderator|
|setpassword|sp|установить пароль для аутентификации|Нет|!sp \<пароль\>|Moderator|
|tempban|tb|временно забанить игрока на указанное время (по умолчанию - 1 час) (мин\|ч\|дни\|мес\|годы)|Да|!tb \<игрок\> \<продолжительность (m\|h\|d\|w\|y)\> \<причина\>|Moderator|
|uptime|up|получить время работы приложения|Нет|!up |Moderator|
|usage|us|получить использование памяти приложением|Нет|!us |Moderator|
|kick|k|исключить игрока по имени|Да|!k \<игрок\> \<причина\>|Trusted|
|login|l|залогинится с использованием пароля|Нет|!l \<пароль\>|Trusted|
|warn|w|предупредить игрока о нарушении правил|Да|!w \<игрок\> \<причина\>|Trusted|
|warnclear|wc|удалить все предупреждения для игрока|Да|!wc \<игрок\>|Trusted|
|admins|a|список подключенных администраторов на сервере|Нет|!a |User|
|getexternalip|ip|просмотр внешнего IP-адреса|Нет|!ip |User|
|help|h|список всех доступных команд|Нет|!h \<опционально команда\>|User|
|ping|pi|получить пинг игрока|Нет|!pi \<опционально игрок\>|User|
|privatemessage|pm|отправить приватное сообщение игроку|Да|!pm \<игрок\> \<сообщение\>|User|
|report|rep|отправить жалобу на игрока|Да|!rep \<игрок\> \<причина\>|User|
|resetstats|rs|сбросить свою статистику|Нет|!rs |User|
|rules|r|список правил сервера|Нет|!r |User|
|stats|xlrstats|просмотреть свою статистику|Нет|!xlrstats \<опционально игрок\>|User|
|topstats|ts|просмотреть 5 лучших игроков на сервере|Нет|!ts |User|
|whoami|who|получить информацию о себе.|Нет|!who |User|

_Эти команды включают в себя все подгруженые команды плагина._

---

#### Идентификация игрока
Все игроки идентифицируются 5 отдельными способами   
1. `npID/GUID/XUID` - Идентификатор соответствующий игровому оборудованию или учетной записи форума  
2. `IP` - IP-адрес игрока   
3. `Client ID` - Внутренняя ссылка на игрока, сгенерированная **IW4MAdmin**   
4. `Name` - Видимое имя игрока, как оно показывется в игре 
5. `Client Number` - Слот, который клиент занимает на сервере. Число колеблется от 0 до максимального количества клиентов, разрешенных на сервере

Для большинства команд игроки идентифицируются их `Name`  
Однако, если они в настоящее время находятся в автономном режиме, или их имя содержит непечатаемые символы то необходимо использовать их `Client ID`  

`Client ID` задается с помощью префикса и номера ссылки на игрока `@`.  
Например: `@123` ссылка на игрока `Client ID` будет 123.  

**Все команды, которые требуют `цель` смотрят на `первый аргумент` в форме идентификации игрока**

---

#### Дополнительные примеры команд
`setlevel`
- _Ярлык_ - `sl`
- _Параметр 1_ - Игрок для изменения уровня
- _Параметр 2_ - Уровень, чтобы установить игроку на ```[ User, Trusted, Moderator, Administrator, SeniorAdmin, Owner ]```
- _Пример _ - `!setlevel Player1 SeniorAdmin`, `!sl @123 Moderator`
- **ПРИМЕЧАНИЕ** - Невозможно установить уровень другого игрока на `owner` если параметр `поддержка нескольких владельцев` в конфигурации не включен во время настройки

`ban`
- _Ярлык_ - `b`
- _Параметр 1_ - Игрок для бана
- _Параметр 2_ - Причина бана
- _Пример_ - `!ban Player1 Замечен читинг`, `!b @123 GUID Обман`

`tempban`
- _Ярлык_ - `tb`
- _Параметр 1_ - Игрок для бана
- _Параметр 2_ - Длительность бана (m-минуты|h-часы|d-дни|w-месяцы|y-годы)
- _Параметр 3_ - Причина бана
- _Пример_ - `!tempban Player1 3w расизм`, `!tb @123 8h Оскорбительное поведение`

`reports`  
- _Ярлык_ - `reps`
- _Опциональный параметр 1_ - `clear` (очищает жалобы для текущего сервера)

___
### Плагины

#### Приветствие   
- Этот плагин использует данные геоданных, чтобы приветствовать игрока в зависимости от его страны происхождения
- Все привилегированные пользователи (доверенные или выше) также получают специализированное приветственное сообщение
- Приветственные сообщения могут быть настроены в `WelcomePluginSettings.json`

#### Статистика
- Этот плагин вычисляет базовую производительность игрока, приближение навыка и коэффициент убийства/смерти 

**Команды, добавленные этим плагином** 

|Полное имя              |Короткое|Описание                                                                               |Надобность цели|Синтаксис           |Требуемый уровень|
|--------------| -----| --------------------------------------------------------| -----------------| -------------| ----------------|
|resetstats|rs|сбросить свою статистику|Нет|!rs |User|
|stats|xlrstats|просмотреть свою статистику|Нет|!xlrstats \<опционально игрок\>|User|
|topstats|ts|просмотреть 5 лучших игроков на этом сервере|Нет|!ts |User|

- Чтобы претендовать на топ-статистику, клиент должен сыграть как минимум `1 час` и подключался в течение последних `30 дней`.

#### Авторизация
- Этот плагин исключает подмену GUID, требуя чтобы привилегированные пользователи входили в систему со своим паролем перед выполнением команд
- Пароль должен быть установлен с помощью `setpassword` команды перед входом в систему

 **Команды, добавленные этим плагином**  

|Полное имя              |Короткое|Описание                                                                               |Надобность цели|Синтаксис           |Требуемый уровень|
|--------------| -----| --------------------------------------------------------| -----------------| -------------| ----------------|
|login|l|залогинится с использованием пароля|Нет|!l \<пароль\>|Trusted|

#### Ненормативная лексика
- Этот плагин предупреждает и исключает игроков за использование ненормативной лексики
- Ненормативные слова и предупреждающее сообщение указываются в `ProfanityDetermentSettings.json`
___
### Веб-интерфейс
`Home`
* Показывает обзор контролируемого сервера(ов)

`Penalties`
* Показывает хронологически упорядоченный список штрафов клиентов (прокрутка вниз - старые штрафы)

`Admins`
* Показывает список привилегированных клиентов

`Login`
* Позволяет привилегированным пользователям входить в систему используя их `Client ID` и пароль установленный через `setpassword`

`Profile`
* Показывает информацию и историю чата клиента 

`Web Console`
* Позволяет зарегистрированным привилегированным пользователям выполнять команды, так если бы они были в игре

---

### Разное
#### Базы данных
Вся информация **IW4MAdmin** сохраняется в файле `Database.db`. Если вам нужно сбросить всю базу данных, то этот файл можно просто удалить. Кроме того, этот файл должен быть сохранен во время обновлений, чтобы сохранить всю информацию о клиентах.
